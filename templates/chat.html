<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<title>Chatbot ‡πÄ‡∏ó‡∏®‡∏ö‡∏≤‡∏•</title>

<style>
body { font-family: sans-serif; background:#f4f6f8; }
.chat-container {
    width:420px; height:650px; background:#fff;
    margin:auto; display:flex; flex-direction:column;
    border-radius:10px; box-shadow:0 0 10px #ccc;
}
.chat-header { background:#2b7cff; color:#fff; padding:10px; text-align:center; }
.chat-body { flex:1; padding:10px; overflow-y:auto; }
.chat-footer { display:flex; padding:10px; gap:5px; }
.message { padding:8px 12px; border-radius:15px; margin-bottom:6px; max-width:80%; }
.user { background:#2b7cff; color:#fff; margin-left:auto; }
.bot { background:#e9ecef; }

#complaintForm input, textarea {
    width:100%; margin-bottom:5px; padding:6px;
}
</style>
</head>

<body>

<div class="chat-container">
    <div class="chat-header">‡πÄ‡∏à‡πâ‡∏≤‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà‡πÄ‡∏ó‡∏®‡∏ö‡∏≤‡∏•</div>

    <div style="padding:8px;text-align:center">
        <button onclick="toggleForm()">üìÑ ‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏£‡πâ‡∏≠‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</button>
    </div>

    <div id="complaintForm" style="display:none; padding:10px;">
        <input id="issue" placeholder="‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡∏ó‡∏µ‡πà‡∏à‡∏∞‡πÅ‡∏à‡πâ‡∏á">
        <input id="department" placeholder="‡∏Å‡∏≠‡∏á / ‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô">
        <input id="location" placeholder="‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà">
        <textarea id="detail" placeholder="‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î"></textarea>
        <button onclick="submitComplaint()">‡∏™‡πà‡∏á‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á</button>
    </div>

    <div class="chat-body" id="chat"></div>

    <div class="chat-footer">
        <input id="msg" placeholder="‡∏û‡∏¥‡∏°‡∏û‡πå‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°..." onkeydown="if(event.key==='Enter') send()">
        <button onclick="send()">‡∏™‡πà‡∏á</button>
    </div>
</div>

<script>
const chat = document.getElementById("chat");

function addMessage(text, sender){
    const div = document.createElement("div");
    div.className = "message " + sender;
    div.innerText = text;
    chat.appendChild(div);
    chat.scrollTop = chat.scrollHeight;
}

function toggleForm(){
    const f = document.getElementById("complaintForm");
    f.style.display = f.style.display === "none" ? "block" : "none";
}

async function submitComplaint(){
    const data = {
        issue: document.getElementById("issue").value,
        department: document.getElementById("department").value,
        location: document.getElementById("location").value,
        detail: document.getElementById("detail").value
    };

    const res = await fetch("/complaint", {
        method:"POST",
        headers:{ "Content-Type":"application/json" },
        body: JSON.stringify(data)
    });

    const result = await res.json();
    addMessage(result.message, "bot"); // ‚úÖ message ‡∏°‡∏µ‡∏à‡∏£‡∏¥‡∏á
    toggleForm();
}


async function send(){
    const input = document.getElementById("msg");
    const text = input.value.trim();
    if(!text) return;

    addMessage(text, "user");
    input.value = "";

    const res = await fetch("/chat", {
        method:"POST",
        headers:{ "Content-Type":"application/json" },
        body: JSON.stringify({ message:text })
    });
    const data = await res.json();
    addMessage(data.reply, "bot");
}
</script>

</body>
</html>
